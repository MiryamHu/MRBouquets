
<ng-container *ngIf="showMinimalView; else fullPage">

  <div class="cart-container">
    <!-- Header -->
    <div class="cart-header">
      <h2>Carrito de Compras</h2>
      <button class="btn-clear" (click)="clearCart()">Vaciar Carrito</button>
      <button class="btn-close" (click)="continueShopping()">√ó</button>
    </div>

    <!-- Items -->
    <div class="cart-items">
      <div class="cart-item" *ngFor="let item of items">
        <img [src]="'http://localhost/MRBouquets/frontend/public/' + item.img" [alt]="item.nombre" class="item-img">
        <div class="item-details">
          <h3>{{ item.nombre }}</h3>
          <p>{{ item.descripcion }}</p>
          <span class="item-price">
            {{ (item.quantity * item.price) | currency:'EUR':'symbol':'1.2-2' }}
          </span>
        </div>
        <div class="quantity-controls">
          <button (click)="decrement(item)">‚Äì</button>
          <span>{{ item.quantity }}</span>
          <button (click)="increment(item)">+</button>
        </div>
        <button class="btn-remove" (click)="removeItem(item.id)">üóëÔ∏è</button>
      </div>
    </div>

    <!-- Resumen -->
    <div class="summary">
      <div class="line">
        <span>Subtotal</span>
        <span>{{ subtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
      </div>
      <div class="line">
        <span>Env√≠o</span>
        <span>Calculado al pagar</span>
      </div>
      <div class="line total">
        <span>Total</span>
        <span>{{ subtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
      </div>
    </div>

    <!-- Acciones finales: continuar comprando o ver cesta completa -->
    <div class="cart-actions">
      <button class="btn-secondary" (click)="continueShopping()">
        Seguir comprando
      </button>
      <button class="btn-primary" (click)="goToPage()">
        Ver cesta
      </button>
    </div>
  </div>

</ng-container>


<ng-template #fullPage>
<div class="cart-container">
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Cabecera ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="cart-header">
    <h2>Carrito de Compras</h2>
    <button class="btn-clear" (click)="clearCart()">Vaciar Carrito</button>
    <button class="btn-close" (click)="continueShopping()">√ó</button>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Lista de productos ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="cart-items">
    <div class="cart-item" *ngFor="let item of items">
      <img
        class="item-img"
        [src]="'http://localhost/MRBouquets/frontend/public/' + item.img"
        [alt]="item.nombre"
      />

      <div class="item-details">
        <h3>{{ item.nombre }}</h3>
        <p>{{ item.descripcion }}</p>
        <span class="item-price">
          {{ item.quantity * item.price | currency:'EUR':'symbol':'1.2-2' }}
        </span>
      </div>

      <div class="quantity-controls">
        <button (click)="decrement(item)">‚Äì</button>
        <span>{{ item.quantity }}</span>
        <button (click)="increment(item)">+</button>
      </div>

      <button class="btn-remove" (click)="removeItem(item.id)">üóëÔ∏è</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Resumen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="summary">
    <div class="line">
      <span>Subtotal</span>
      <span>{{ subtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
    </div>
    <div class="line">
      <span>Env√≠o</span>
      <span>Calculado al pagar</span>
    </div>
    <div class="line total">
      <span>Total</span>
      <span>{{ subtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Acciones ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <button class="btn-primary full-width" (click)="proceedToCheckout()">
    Proceder al Pago
  </button>
  <button class="btn-secondary full-width" (click)="continueShopping()">
    Seguir Comprando
  </button>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Modal: Selecci√≥n de direcci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="modal-backdrop" *ngIf="showAddressModal">
    <div class="modal direccion-modal">
      <h3>Selecciona una direcci√≥n de env√≠o</h3>
      
      <div *ngIf="direcciones.length === 0" class="no-direcciones-message">
        <p>Hemos detectado que a√∫n no tienes direcciones guardadas.</p>
        <p>Por favor, agrega una direcci√≥n antes de continuar con tu compra.</p>
        <button class="btn-primary" (click)="router.navigate(['/mi-perfil'])">
          Agregar Direcci√≥n
        </button>
      </div>
      
      <div class="direcciones-lista" *ngIf="direcciones.length > 0">
        <div *ngFor="let d of direcciones" 
             class="direccion-option" 
             [class.selected]="selectedDireccionId === d.id"
             (click)="selectedDireccionId = d.id">
          <div class="direccion-header">
            <span class="direccion-nombre">{{ d.nombre }}</span>
            <div class="radio-button" [class.selected]="selectedDireccionId === d.id">
              <div class="radio-inner"></div>
            </div>
          </div>
          <div class="direccion-detalles">
            <p>{{ d.calle }} {{ d.numero }}</p>
            <p *ngIf="d.piso">Piso {{ d.piso }}, {{ d.puerta }}</p>
            <p>{{ d.codigo_postal }} {{ d.localidad }}</p>
            <p>{{ d.provincia }}, {{ d.pais }}</p>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-secondary" (click)="showAddressModal = false">
          Cancelar
        </button>
        <button
          class="btn-primary"
          (click)="confirmarDireccion()"
          [disabled]="!selectedDireccionId"
          *ngIf="direcciones.length > 0">
          Confirmar Direcci√≥n
        </button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Modal: Pedido confirmado ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="modal-backdrop" *ngIf="showSuccessModal">
    <div class="modal">
      <p>Su pedido est√° confirmado, gracias por su compra.</p>
      <button class="btn-primary" (click)="closeSuccessModal()">Cerrar</button>
    </div>
  </div>
</div>

</ng-template>

